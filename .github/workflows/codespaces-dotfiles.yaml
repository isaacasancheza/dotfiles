name: Copy dotfiles to codespaces

on:
  push:
    branches:
      - master

jobs:
  chezmoi:
    runs-on: ubuntu-latest
    steps:
      - name: download and apply chezmoi
        env: 
          USERNAME: ${{ github.actor }}
        working-directory: ${{ github.workspace }}
        run: |
          mkdir -p /home/runner/chezmoi /home/runner/dotfiles
          sh -c "$(curl -fsLS get.chezmoi.io)" -- init --source /home/runner/chezmoi --destination /home/runner/dotfiles --apply $USERNAME
          ls /home/runner/dotfiles

      - name: push to repo
        env:
          REPOSITORY: https://github.com/${{ github.username }}/dotfiles
        run: |
          cd /home/runner/dotfiles
          git push $REPOSITORY origin main
