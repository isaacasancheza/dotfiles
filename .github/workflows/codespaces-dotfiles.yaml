name: Copy dotfiles to codespaces

on:
  push:
    branches:
      - master

jobs:
  chezmoi:
    runs-on: ubuntu-latest
    env:
      DESTINATION: /dotfiles
    steps:
      - name: download chezmoi
        env: 
          USERNAME: ${{ github.username }}
        run: sh -c "$(curl -fsLS get.chezmoi.io)" -- init --destination $DESTINATION  --apply $USERNAME
      - name: push to repo
          working-directory: ${{ jobs.chezmoi.env.DESTINATION }}
          REPOSITORY: https://github.com/${{ github.username }}/dotfiles
        run: git push $REPOSITORY origin main
